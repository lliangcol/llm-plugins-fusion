# 核心用户流程（User Flows）

> 目标：把“选命令 → 填字段 → 生成可粘贴文本 → 复用/导出”固化为低摩擦流程；在工作流模式下允许跳过，但要显式提示依赖缺失。

## Flow A：单命令生成（Single Command）

```mermaid
flowchart TD
  A[进入：场景首页/命令列表] --> B[选择命令]
  B --> C[生成面板：填写字段]
  C --> D{需要上下文文件?}
  D -- 否 --> E[预览命令文本]
  D -- 是 --> D1[上传文件]
  D1 --> D2[选择插入策略：路径/片段/全文]
  D2 --> E[预览命令文本]
  E --> F{校验必填字段通过?}
  F -- 否 --> F1[高亮缺失字段/阻断生成]
  F -- 是 --> G[生成命令详情 + 复制]
  G --> H[保存到应用内（历史/草稿）]
  H --> I{需要导出到本地?}
  I -- 否 --> J[结束]
  I -- 是 --> I1[导出：md/txt/json]
  I1 --> I2{能力检测}
  I2 -- 桌面可写入 --> I3[保存到文件（用户选择）]
  I2 -- 移动端/不支持 --> I4[下载/分享（系统接管保存位置）]
  I3 --> J
  I4 --> J
```

## Flow B：工作流分步（Workflow Stepper，可跳过）

```mermaid
flowchart TD
  A[进入：工作流列表] --> B[选择工作流模板]
  B --> C[Stepper：显示步骤与依赖]
  C --> D[步骤1：生成面板]
  D --> E[生成并保存到应用内]
  E --> F[注册产物变量：例如 plan_output_path]
  F --> G{下一步是否跳过?}
  G -- 是 --> G1[标记 skipped + 提示依赖缺失]
  G -- 否 --> H[步骤2：自动填充可绑定字段]
  H --> I[用户补充/确认字段]
  I --> J[生成并保存到应用内]
  J --> K{还有步骤?}
  K -- 是 --> G
  K -- 否 --> L[导出：单步或整条工作流（zip 可后续）]
```

## Flow C：复用历史（Runs / Drafts）

```mermaid
flowchart TD
  A[进入：历史] --> B[选择一条记录]
  B --> C{复用方式}
  C -- 直接复制命令文本 --> D[复制]
  C -- 重新编辑字段 --> E[载入表单 + 打开生成面板]
  E --> F[修改字段/文件插入策略]
  F --> G[重新生成并覆盖/另存]
  C -- 导出 --> H[导出：md/txt/json]
```

## Flow D：变量与依赖提示（Bindings）

- 变量来源：
  - 工作流步骤的“产物字段”（如 `PLAN_OUTPUT_PATH`）
  - 用户粘贴的 Claude Code 输出（手动注册为 `{{explore_output}}` 等）
- 当后续字段引用 `{{var}}` 缺失：
  - 预览中显示 `<<MISSING:var>>`
  - 在 Stepper 中显示“缺失依赖”的清单（可跳转到产生变量的步骤）

